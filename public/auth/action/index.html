<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=0.85, maximum-scale=0.85, user-scalable=no" />
<title>Reset Password â€¢ CUBE</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root {
  --neon: #c3f60c;
  --neon-dark: #a0d00a;
  --deep: #0a1400;
  --glow: rgba(195, 246, 12, 0.3);
  --input-bg: rgba(10, 25, 0, 0.65);
  --input-border: rgba(195, 246, 12, 0.5);
}

* {
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  background: radial-gradient(circle at top, #142400, #050900);
  color: #eaffc7;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.card {
  width: 420px;
  background: rgba(5, 10, 0, 0.9);
  border: 1px solid var(--input-border);
  border-radius: 16px;
  padding: 36px;
  box-shadow: 0 0 20px var(--glow);
}

.logo {
  text-align: center;
  margin-bottom: 24px;
}

.logo img {
  max-width: 120px;
}

h1 {
  font-size: 20px;
  margin-bottom: 10px;
  text-align: center;
}

p {
  font-size: 14px;
  opacity: 0.9;
  text-align: center;
  margin-bottom: 20px;
}

/* Password input wrapper */
.field {
  position: relative;
  margin-bottom: 14px;
}

.field input {
  width: 100%;
  padding: 14px 42px 14px 14px;
  border-radius: 10px;
  background: var(--input-bg);
  border: 1px solid var(--input-border);
  color: #fff;
  outline: none;
}

.eye {
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 16px;
  opacity: 0.7;
}

button {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, var(--neon), var(--neon-dark));
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  color: #000;
  box-shadow: 0 0 12px var(--glow);
}

button:hover {
  transform: translateY(-1px);
}

.error {
  color: #ff5c5c;
  text-align: center;
  font-size: 13px;
  margin-top: 10px;
}

.success {
  color: var(--neon);
  text-align: center;
  font-size: 15px;
  margin-top: 10px;
}
.strength-bar {
  width: 100%;
  height: 6px;
  background: #222;
  border-radius: 3px;
  margin-top: 8px;
  overflow: hidden;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
}

#strengthFill {
  height: 100%;
  width: 0%;
  border-radius: 3px;
  transition: all 0.4s ease;
  background: linear-gradient(90deg, #ff4444, #ffaa00, #a0d00a, #c3f60c);
}

.strength-text {
  font-size: 12px;
  text-align: left;
  margin-top: 6px;
  color: #aaa;
  min-height: 18px;
  transition: color 0.3s ease;
}
.reset-container {
  width: 100%;
  max-width: 420px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.redirect-countdown {
  margin-top: 28px;
  text-align: center;
  font-size: 14px;
  color: #e0ff80;
  opacity: 0;
  transition: opacity 0.5s ease;
}

.redirect-countdown.visible {
  opacity: 1;
}

.redirect-countdown strong {
  color: #fff;
  font-weight: 800;
}
</style>
</head>

<body>

<div class="card">

  <!-- ðŸ”° LOGO -->
  <div class="logo">
    <img src="https://cdn.shopify.com/s/files/1/0962/6648/6067/files/HABA_HOUSE.png?v=1765412962" alt="Logo" onerror="this.style.display='none'">
  </div>

  <h1>Reset Your Password</h1>
  <p>Choose a new password to regain access.</p>

 <!-- New Password Field with Eye Toggle + Strength Meter -->
<div class="field">
  <input type="password" id="password" placeholder="New password" />
  <span class="eye" id="togglePassword">
    <!-- Eye open SVG (default state) -->
    <svg viewBox="0 0 519.578 519.578" fill="#d6d6d6" width="20" height="20">
      <path d="M513.095,245.101c0,0-140.683-139.842-253.291-139.842c-112.608,0-253.292,139.842-253.292,139.842 c-8.645,8.109-8.721,21.42,0,29.375c0,0,140.684,139.843,253.292,139.843c112.608,0,253.291-139.843,253.291-139.843 C521.663,266.368,521.816,253.134,513.095,245.101z M260.875,372.397c-61.889,0-112.149-50.185-112.149-112.149 s50.184-112.149,112.149-112.149c61.965,0,112.148,50.26,112.148,112.149S322.763,372.397,260.875,372.397z"></path>
      <path d="M259.574,187.726c-39.321,0-71.222,32.053-71.222,71.451c0,39.397,31.901,71.451,71.222,71.451 c39.321,0,71.222-32.054,71.222-71.451C330.796,219.78,298.896,187.726,259.574,187.726z M286.426,259.407 c-12.163,0-22.108-9.946-22.108-22.262s9.945-22.261,22.108-22.261s22.108,9.945,22.108,22.261S298.742,259.407,286.426,259.407z"></path>
    </svg>
  </span>
</div>

<!-- Password Strength Meter (only under New password) -->
<div class="strength-bar">
  <div id="strengthFill"></div>
</div>
<div id="strengthText" class="strength-text"></div>

<!-- Confirm Password Field with Eye Toggle -->
<div class="field">
  <input type="password" id="confirm" placeholder="Confirm password" />
  <span class="eye" id="toggleConfirm">
    <!-- Eye open SVG (default state) -->
    <svg viewBox="0 0 519.578 519.578" fill="#d6d6d6" width="20" height="20">
      <path d="M513.095,245.101c0,0-140.683-139.842-253.291-139.842c-112.608,0-253.292,139.842-253.292,139.842 c-8.645,8.109-8.721,21.42,0,29.375c0,0,140.684,139.843,253.292,139.843c112.608,0,253.291-139.843,253.291-139.843 C521.663,266.368,521.816,253.134,513.095,245.101z M260.875,372.397c-61.889,0-112.149-50.185-112.149-112.149 s50.184-112.149,112.149-112.149c61.965,0,112.148,50.26,112.148,112.149S322.763,372.397,260.875,372.397z"></path>
      <path d="M259.574,187.726c-39.321,0-71.222,32.053-71.222,71.451c0,39.397,31.901,71.451,71.222,71.451 c39.321,0,71.222-32.054,71.222-71.451C330.796,219.78,298.896,187.726,259.574,187.726z M286.426,259.407 c-12.163,0-22.108-9.946-22.108-22.262s9.945-22.261,22.108-22.261s22.108,9.945,22.108,22.261S298.742,259.407,286.426,259.407z"></path>
    </svg>
  </span>
</div>

<!-- Reset Button & Message -->
<button id="resetBtn">Reset Password</button>
<div id="message"></div>

  
<!-- ðŸ”Œ Firebase CDN + reset logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, confirmPasswordReset } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD_GjkTox5tum9o4AupO0LeWzjTocJg8RI",
  authDomain: "dettyverse.firebaseapp.com",
  projectId: "dettyverse",
  storageBucket: "dettyverse.firebasestorage.app",
  messagingSenderId: "1036459652488",
  appId: "1:1036452488:web:e8910172ed16e9cac9b63d",
  databaseURL: "https://dettyverse-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const params = new URLSearchParams(window.location.search);
const mode = params.get('mode');
const oobCode = params.get('oobCode');

const msg = document.getElementById('message');
const btn = document.getElementById('resetBtn');
const password = document.getElementById('password');
const confirm = document.getElementById('confirm');

if (mode !== 'resetPassword' || !oobCode) {
  msg.innerHTML = `<div class="error">Invalid or expired reset link.</div>`;
  btn.disabled = true;
}

btn.onclick = async () => {
  const p1 = password.value;
  const p2 = confirm.value;

  if (p1.length < 8) {
    msg.innerHTML = `<div class="error">Password must be at least 8 characters.</div>`;
    return;
  }

  if (p1 !== p2) {
    msg.innerHTML = `<div class="error">Passwords do not match.</div>`;
    return;
  }

    try {
      await confirmPasswordReset(auth, oobCode, p1);

      // Inside card: success message
      msg.innerHTML = `<div class="success">Password reset successful!<br>You'll be redirected shortly.</div>`;

      // Button update
      btn.textContent = "Reset Complete âœ“";
      btn.style.background = "linear-gradient(135deg, #a0d00a, #80b000)";
      btn.disabled = true;

      // Countdown OUTSIDE card
      const countdownEl = document.getElementById('redirectCountdown');
      let countdown = 3;
      countdownEl.innerHTML = `Redirecting to chat in <strong>${countdown}</strong> seconds...`;
      countdownEl.classList.add('visible');

      const timer = setInterval(() => {
        countdown--;
        if (countdown > 0) {
          countdownEl.querySelector('strong').textContent = countdown;
        } else {
          clearInterval(timer);
          window.location.href = "https://cube.xixi.live/chat";
        }
      }, 1000);

    } catch (e) {
      msg.innerHTML = `<div class="error">${e.message}</div>`;
    }
};

// ðŸ”‘ Eye toggle logic
function toggleEye(inputId, toggleId) {
  const input = document.getElementById(inputId);
  const toggle = document.getElementById(toggleId);
  
  if (input.type === 'password') {
    input.type = 'text';
    toggle.innerHTML = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#a3a3a3"><path stroke="#6b6b6b" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10a13.358 13.358 0 0 0 3 2.685M21 10a13.358 13.358 0 0 1-3 2.685m-8 1.624L9.5 16.5m.5-2.19a10.59 10.59 0 0 0 4 0m-4 0a11.275 11.275 0 0 1-4-1.625m8 1.624.5 2.191m-.5-2.19a11.275 11.275 0 0 0 4-1.625m0 0 1.5 1.815M6 12.685 4.5 14.5"></path></svg>';
  } else {
    input.type = 'password';
    toggle.innerHTML = '<svg viewBox="0 0 519.578 519.578" fill="#d6d6d6" width="20" height="20"><path d="M513.095,245.101c0,0-140.683-139.842-253.291-139.842c-112.608,0-253.292,139.842-253.292,139.842 c-8.645,8.109-8.721,21.42,0,29.375c0,0,140.684,139.843,253.292,139.843c112.608,0,253.291-139.843,253.291-139.843 C521.663,266.368,521.816,253.134,513.095,245.101z M260.875,372.397c-61.889,0-112.149-50.185-112.149-112.149 s50.184-112.149,112.149-112.149c61.965,0,112.148,50.26,112.148,112.149S322.763,372.397,260.875,372.397z"></path><path d="M259.574,187.726c-39.321,0-71.222,32.053-71.222,71.451c0,39.397,31.901,71.451,71.222,71.451 c39.321,0,71.222-32.054,71.222-71.451C330.796,219.78,298.896,187.726,259.574,187.726z M286.426,259.407 c-12.163,0-22.108-9.946-22.108-22.262s9.945-22.261,22.108-22.261s22.108,9.945,22.108,22.261S298.742,259.407,286.426,259.407z"></path></svg>';
  }
}

document.getElementById('togglePassword').onclick = () => toggleEye('password','togglePassword');
document.getElementById('toggleConfirm').onclick = () => toggleEye('confirm','toggleConfirm');

// Password Strength Checker
const passwordInput = document.getElementById('password');
const strengthFill = document.getElementById('strengthFill');
const strengthText = document.getElementById('strengthText');

function checkPasswordStrength(password) {
  let strength = 0;
  let text = "";
  let colorWidth = "0%";

  if (password.length >= 8) strength += 1;
  if (password.length >= 12) strength += 1;
  if (/[a-z]/.test(password)) strength += 1;
  if (/[A-Z]/.test(password)) strength += 1;
  if (/[0-9]/.test(password)) strength += 1;
  if (/[^A-Za-z0-9]/.test(password)) strength += 1;

  switch (strength) {
    case 0:
    case 1:
    case 2:
      text = "Weak";
      colorWidth = "25%";
      strengthText.style.color = "#ff5c5c";
      break;
    case 3:
    case 4:
      text = "Medium";
      colorWidth = "50%";
      strengthText.style.color = "#ffaa00";
      break;
    case 5:
      text = "Strong";
      colorWidth = "75%";
      strengthText.style.color = "#a0d00a";
      break;
    case 6:
      text = "Very Strong";
      colorWidth = "100%";
      strengthText.style.color = "#c3f60c";
      break;
  }

  strengthFill.style.width = colorWidth;
  strengthText.textContent = text;
}

// Real-time update
passwordInput.addEventListener('input', () => {
  checkPasswordStrength(passwordInput.value);
});

// Initial check (empty)
checkPasswordStrength('');
</script>

</body>
</html>
