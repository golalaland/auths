<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=0.85, maximum-scale=0.85, user-scalable=no" />
<title>Reset Password â€¢ CUBE</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root {
  --neon: #c3f60c;
  --neon-dark: #a0d00a;
  --deep: #0a1400;
  --glow: rgba(195, 246, 12, 0.3);
  --input-bg: rgba(10, 25, 0, 0.65);
  --input-border: rgba(195, 246, 12, 0.5);
}

* {
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  background: radial-gradient(circle at top, #142400, #050900);
  color: #eaffc7;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.card {
  width: 420px;
  background: rgba(5, 10, 0, 0.9);
  border: 1px solid var(--input-border);
  border-radius: 16px;
  padding: 36px;
  box-shadow: 0 0 20px var(--glow);
}

.logo {
  text-align: center;
  margin-bottom: 24px;
}

.logo img {
  max-width: 120px;
}

h1 {
  font-size: 20px;
  margin-bottom: 10px;
  text-align: center;
}

p {
  font-size: 14px;
  opacity: 0.9;
  text-align: center;
  margin-bottom: 20px;
}

/* Password input wrapper */
.field {
  position: relative;
  margin-bottom: 14px;
}

.field input {
  width: 100%;
  padding: 14px 42px 14px 14px;
  border-radius: 10px;
  background: var(--input-bg);
  border: 1px solid var(--input-border);
  color: #fff;
  outline: none;
}

.eye {
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 16px;
  opacity: 0.7;
}

button {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, var(--neon), var(--neon-dark));
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  color: #000;
  box-shadow: 0 0 12px var(--glow);
}

button:hover {
  transform: translateY(-1px);
}

.error {
  color: #ff5c5c;
  text-align: center;
  font-size: 13px;
  margin-top: 10px;
}

.success {
  color: var(--neon);
  text-align: center;
  font-size: 15px;
  margin-top: 10px;
}
.strength-bar {
  width: 100%;
  height: 6px;
  background: #222;
  border-radius: 3px;
  margin-top: 8px;
  overflow: hidden;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.5);
}

#strengthFill {
  height: 100%;
  width: 0%;
  border-radius: 3px;
  transition: all 0.4s ease;
  background: linear-gradient(90deg, #ff4444, #ffaa00, #a0d00a, #c3f60c);
}

.strength-text {
  font-size: 12px;
  text-align: left;
  margin-top: 6px;
  color: #aaa;
  min-height: 18px;
  transition: color 0.3s ease;
}
.reset-container {
  width: 100%;
  max-width: 420px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.redirect-countdown {
  margin-top: 28px;
  text-align: center;
  font-size: 14px;
  color: #e0ff80;
  opacity: 0;
  transition: opacity 0.5s ease;
}

.redirect-countdown.visible {
  opacity: 1;
}

.redirect-countdown strong {
  color: #fff;
  font-weight: 800;
}
.field {
  position: relative;
  margin-bottom: 16px;
}

.field input {
  width: 100%;
  padding: 12px 40px 12px 16px;
  border-radius: 12px;
  border: 1px solid #444;
  background: #111;
  color: #fff;
}

.eye {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.eye svg {
  transition: all 0.2s ease;
}

.eye:hover svg {
  stroke: #00ffea; /* Neon hover glow */
  filter: drop-shadow(0 0 6px rgba(0,255,234,0.5));
}
</style>
</head>

<body>

<!-- Main container to center everything -->
<div class="reset-container">
  <!-- The actual card/modal -->
  <div class="card">
    <!-- ðŸ”° LOGO -->
    <div class="logo">
      <img src="https://cdn.shopify.com/s/files/1/0962/6648/6067/files/HABA_HOUSE.png?v=1765412962" alt="Logo" onerror="this.style.display='none'">
    </div>
    <h1>Reset Your Password</h1>
    <p>Choose a new password to regain access.</p>

   <!-- New Password + Strength Meter -->
<div class="field">
  <input type="password" id="password" placeholder="New password" />
  <span class="eye" id="togglePassword">
    <!-- Closed Eye (default - password hidden) -->
    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#a3a3a3">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
      <line x1="1" y1="1" x2="23" y2="23" stroke-linecap="round" stroke-width="2" />
    </svg>
  </span>
</div>

<!-- Confirm Password -->
<div class="field">
  <input type="password" id="confirm" placeholder="Confirm password" />
  <span class="eye" id="toggleConfirm">
    <!-- Same closed eye by default -->
    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#a3a3a3">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
            d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
      <line x1="1" y1="1" x2="23" y2="23" stroke-linecap="round" stroke-width="2" />
    </svg>
  </span>
</div>

    <!-- Button + Message -->
    <button id="resetBtn">Reset Password</button>
    <div id="message"></div>
  </div>
  <!-- â† Card ends here -->

  <!-- Countdown: OUTSIDE the card, just like forgot page -->
  <div id="redirectCountdown" class="redirect-countdown"></div>
</div>
<!-- â† Container ends -->

  
<!-- ðŸ”Œ Firebase CDN + reset logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, confirmPasswordReset } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD_GjkTox5tum9o4AupO0LeWzjTocJg8RI",
  authDomain: "dettyverse.firebaseapp.com",
  projectId: "dettyverse",
  storageBucket: "dettyverse.firebasestorage.app",
  messagingSenderId: "1036459652488",
  appId: "1:1036452488:web:e8910172ed16e9cac9b63d",
  databaseURL: "https://dettyverse-default-rtdb.firebaseio.com/"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const params = new URLSearchParams(window.location.search);
const mode = params.get('mode');
const oobCode = params.get('oobCode');

const msg = document.getElementById('message');
const btn = document.getElementById('resetBtn');
const password = document.getElementById('password');
const confirm = document.getElementById('confirm');

// Initial check: invalid or missing link
if (mode !== 'resetPassword' || !oobCode) {
  msg.innerHTML = `<div class="error">Invalid or expired reset link.</div>`;
  btn.disabled = true;
}

// Main reset button handler
btn.onclick = async () => {
  const p1 = password.value.trim();
  const p2 = confirm.value.trim();

  // Basic validation
  if (p1.length < 8) {
    msg.innerHTML = `<div class="error">Password must be at least 8 characters.</div>`;
    return;
  }
  if (p1 !== p2) {
    msg.innerHTML = `<div class="error">Passwords do not match.</div>`;
    return;
  }

  // Disable button during processing
  btn.disabled = true;
  btn.textContent = "Resetting...";

  try {
    await confirmPasswordReset(auth, oobCode, p1);

    // SUCCESS STATE
    msg.innerHTML = `<div class="success">
      Password reset successful!<br>
    </div>`;

    btn.textContent = "Reset Complete âœ“";
    btn.style.background = "linear-gradient(135deg, #a0d00a, #80b000)";

    // COUNTDOWN + REDIRECT (safe even if element is missing)
    const countdownEl = document.getElementById('redirectCountdown');
    let countdown = 3;

    if (countdownEl) {
      countdownEl.innerHTML = `Redirecting to lounge in <strong>${countdown}</strong> seconds...`;
      countdownEl.classList.add('visible');
    }

    const timer = setInterval(() => {
      countdown--;
      if (countdown > 0) {
        if (countdownEl) {
          countdownEl.querySelector('strong').textContent = countdown;
        }
      } else {
        clearInterval(timer);
        window.location.href = "https://cube.xixi.live/chat";
      }
    }, 1000);

  } catch (e) {
    // ERROR HANDLING (friendly + helpful)
    let errorMessage = "Something went wrong. Please try again.";
    let showRetryLink = false;

    if (e.code === 'auth/invalid-action-code' || e.code === 'auth/expired-action-code') {
      errorMessage = "This reset link is invalid or has already expired.";
      showRetryLink = true;
    } else if (e.code === 'auth/user-disabled') {
      errorMessage = "This account has been disabled.";
    } else if (e.code === 'auth/weak-password') {
      errorMessage = "Password is too weak. Please use a stronger one.";
    } else if (e.message) {
      errorMessage = e.message;
    }

    msg.innerHTML = `<div class="error">${errorMessage}</div>`;

    // Add "Request new link" button for expired/invalid codes
    if (showRetryLink) {
      const retryLink = document.createElement('a');
      retryLink.href = "https://auth.cube.xixi.live/forgot.html"; // change if needed
      retryLink.textContent = "Request a new reset link";
      retryLink.style.display = "block";
      retryLink.style.marginTop = "16px";
      retryLink.style.color = "var(--neon)";
      retryLink.style.fontSize = "14px";
      retryLink.style.textAlign = "center";
      retryLink.style.textDecoration = "underline";
      retryLink.style.fontWeight = "600";
      msg.appendChild(retryLink);
    }

    // Re-enable button on error
    btn.disabled = false;
    btn.textContent = "Reset Password";
    btn.style.background = ""; // reset to original
  }
};

function toggleEye(inputId, toggleId) {
  const input = document.getElementById(inputId);
  const toggle = document.getElementById(toggleId);

  if (input.type === 'password') {
    // Show password â†’ open eye
    input.type = 'text';
    toggle.innerHTML = `
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#a3a3a3">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
        <circle cx="12" cy="12" r="3" stroke-width="2" />
      </svg>
    `;
  } else {
    // Hide password â†’ slashed/closed eye
    input.type = 'password';
    toggle.innerHTML = `
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="#a3a3a3">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
        <line x1="1" y1="1" x2="23" y2="23" stroke-linecap="round" stroke-width="2" />
      </svg>
    `;
  }
}

// Attach click events
document.getElementById('togglePassword').onclick = () => toggleEye('password', 'togglePassword');
document.getElementById('toggleConfirm').onclick = () => toggleEye('confirm', 'toggleConfirm');
// Password Strength Checker
const passwordInput = document.getElementById('password');
const strengthFill = document.getElementById('strengthFill');
const strengthText = document.getElementById('strengthText');

function checkPasswordStrength(password) {
  let strength = 0;
  let text = "";
  let colorWidth = "0%";

  if (password.length >= 8) strength += 1;
  if (password.length >= 12) strength += 1;
  if (/[a-z]/.test(password)) strength += 1;
  if (/[A-Z]/.test(password)) strength += 1;
  if (/[0-9]/.test(password)) strength += 1;
  if (/[^A-Za-z0-9]/.test(password)) strength += 1;

  switch (strength) {
    case 0:
    case 1:
    case 2:
      text = "Weak";
      colorWidth = "25%";
      strengthText.style.color = "#ff5c5c";
      break;
    case 3:
    case 4:
      text = "Medium";
      colorWidth = "50%";
      strengthText.style.color = "#ffaa00";
      break;
    case 5:
      text = "Strong";
      colorWidth = "75%";
      strengthText.style.color = "#a0d00a";
      break;
    case 6:
      text = "Very Strong";
      colorWidth = "100%";
      strengthText.style.color = "#c3f60c";
      break;
  }

  strengthFill.style.width = colorWidth;
  strengthText.textContent = text;
}

// Real-time update
passwordInput.addEventListener('input', () => {
  checkPasswordStrength(passwordInput.value);
});

// Initial check (empty)
checkPasswordStrength('');
</script>
</body>
</html>
